{% extends 'layout.html' %}
{% block page_content %}
<div class="glass-panel scan-box animate-fade">
    <i class="fas fa-file-pdf" style="font-size: 4rem; color: var(--primary); margin-bottom: 2rem;"></i>
    <h2>PDF Phishing Scanner</h2>
    <p style="color: var(--text-muted);">Upload a document (resume, invoice) to extract and scan embedded links.</p>

    <div style="margin: 2rem 0;">
        <form method="POST" enctype="multipart/form-data" id="pdfForm"
            style="border: 2px dashed var(--glass-border); padding: 3rem; border-radius: 12px; text-align: center; cursor: pointer; transition: all 0.3s;">
            <input type="file" name="file" id="fileInput" accept="application/pdf" style="display: none;"
                onchange="updateFileName(this)">

            <div id="dropZone" onclick="document.getElementById('fileInput').click()">
                <i class="fas fa-cloud-upload-alt"
                    style="font-size: 3rem; color: var(--text-muted); margin-bottom: 1rem;"></i>
                <h4 style="margin-bottom: 0.5rem;" id="fileName">Click or Drag PDF Here</h4>
                <p style="font-size: 0.9rem; color: var(--text-muted);">Max 5MB</p>
            </div>

            <button type="submit" class="btn-primary" style="margin-top: 2rem; width: 100%;">
                <i class="fas fa-search"></i> SCAN DOCUMENT
            </button>
        </form>
    </div>
</div>

<script>
    function updateFileName(input) {
        if (input.files && input.files[0]) {
            document.getElementById('fileName').innerText = input.files[0].name;
            document.getElementById('fileName').style.color = 'var(--success)';
            document.getElementById('dropZone').style.borderColor = 'var(--success)';
        }
    }

    // Drag and drop basics
    const dropZone = document.getElementById('dropZone');
    dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.style.opacity = '0.7';
    });
    dropZone.addEventListener('dragleave', (e) => {
        e.preventDefault();
        dropZone.style.opacity = '1';
    });
    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.style.opacity = '1';
        const files = e.dataTransfer.files;
        document.getElementById('fileInput').files = files;
        updateFileName(document.getElementById('fileInput'));
    });

    // Form Submit Handler
    document.getElementById('pdfForm').addEventListener('submit', function (e) {
        const fileInput = document.getElementById('fileInput');
        if (!fileInput.files.length) {
            e.preventDefault();
            alert('Please select a PDF file first.');
            return;
        }
        document.getElementById('loadingOverlay').style.display = 'flex';
    });
</script>

<!-- Loading Overlay -->
<div id="loadingOverlay"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 1000; flex-direction: column; justify-content: center; align-items: center; backdrop-filter: blur(5px);">
    <div class="loader"
        style="width: 60px; height: 60px; border: 4px solid var(--primary-dim); border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite;">
    </div>
    <h3 style="margin-top: 1.5rem; color: var(--text-main);">Scanning Document...</h3>
    <p style="color: var(--text-muted);">Extracting links and analyzing threats via AI</p>
</div>

<style>
    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }
</style>
{% endblock %}